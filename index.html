<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>PDF é¤é»æŠ½ç±¤å°å·¥å…·</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.4.120/pdf.min.js"></script>
  <style>
    body { font-family: sans-serif; padding: 20px; max-width: 600px; margin: auto; }
    .category { margin-top: 20px; padding: 10px; border: 1px solid #ccc; border-radius: 8px; }
    .item { margin-left: 10px; }
    button { margin-top: 10px; }
    input, select { margin: 0 5px; }
  </style>
</head>
<body>
  <h2>ğŸ“„ ä¸Šå‚³ PDF ä¸¦æŠ½é¤é»</h2>
  <input type="file" id="fileInput" /><br/>

  <div style="margin-top: 20px;">
    <label>å‰¯é£Ÿï¼š</label>
    <select id="sideType">
      <option value="all">å…¨éƒ¨</option>
      <option value="é£²">é£²æ–™</option>
      <option value="é»">é»å¿ƒ</option>
    </select>
    <label>é ç®— â‰¤</label>
    <input id="maxPrice" type="number" value="200" style="width: 60px;" />
    <label>ç†±é‡ â‰¤</label>
    <input id="maxKcal" type="number" value="1500" style="width: 60px;" />
  </div>

  <div id="output"></div>

  <script>
    let data = [];

    document.getElementById('fileInput').addEventListener('change', async (e) => {
      const file = e.target.files[0];
      if (!file) return;
      const arrayBuffer = await file.arrayBuffer();
      const pdf = await pdfjsLib.getDocument({ data: arrayBuffer }).promise;

      data = [];
      let fullText = '';
      for (let i = 1; i <= pdf.numPages; i++) {
        const content = await (await pdf.getPage(i)).getTextContent();
        fullText += content.items.map(item => item.str).join(' ') + '\n';
      }

      fullText.split('\n').forEach(line => {
        const parts = line.trim().split(/\s+/);
        if (parts.length >= 4) {
          const [category, name, kcal, price] = parts;
          if (!isNaN(kcal) && !isNaN(price)) {
            data.push({category, name, kcal, price});
          }
        }
      });

      const grouped = {};
      data.forEach(i => {
        if (!grouped[i.category]) grouped[i.category] = [];
        grouped[i.category].push(i);
      });

      const out = document.getElementById('output');
      out.innerHTML = '';
      for (const [cat, items] of Object.entries(grouped)) {
        const div = document.createElement('div');
        div.className = 'category';
        div.innerHTML = `<h3>ğŸ“ ${cat}</h3>`;
        items.forEach(i => {
          div.innerHTML += `<div class="item">ğŸ± ${i.name} ï½œ ${i.kcal} kcal ï½œ $${i.price}</div>`;
        });
        out.appendChild(div);
      }

      const comboBtn = document.createElement('button');
      comboBtn.textContent = 'ğŸ¯ æŠ½ä¸€çµ„';
      comboBtn.onclick = () => {
        const sideType = document.getElementById('sideType').value;
        const maxPrice = parseInt(document.getElementById('maxPrice').value);
        const maxKcal = parseInt(document.getElementById('maxKcal').value);

        const mains = data.filter(i => i.category.includes("ä¸»"));
        let sides = data.filter(i => {
          if (sideType === 'all') return i.category.includes("é£²") || i.category.includes("é»");
          return i.category.includes(sideType);
        });

        if (!mains.length || !sides.length) {
          return alert('ä¸»é£Ÿæˆ–å‰¯é£Ÿä¸è¶³ã€‚');
        }

        let tries = 100, main, side, tp, tk;
        while (tries--) {
          main = mains[Math.floor(Math.random()*mains.length)];
          side = sides[Math.floor(Math.random()*sides.length)];
          tp = parseInt(main.price) + parseInt(side.price);
          tk = parseInt(main.kcal) + parseInt(side.kcal);
          if (tp <= maxPrice && tk <= maxKcal) break;
        }
        if (tp > maxPrice || tk > maxKcal) {
          return alert('ç„¡ç¬¦åˆæ¢ä»¶çš„çµ„åˆï¼Œè«‹èª¿æ•´ä¸Šé™ã€‚');
        }

        alert(`ä»Šå¤©åƒğŸ‘£\nä¸»é£Ÿï¼š${main.name}ï¼ˆ${main.kcal} kcal / $${main.price}ï¼‰\nå‰¯é£Ÿï¼š${side.name}ï¼ˆ${side.kcal} kcal / $${side.price}ï¼‰\nåˆè¨ˆï¼š${tk} kcal / $${tp}`);
      };
      out.appendChild(comboBtn);
    });
  </script>
</body>
</html>
