<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>PDF é¤é»æŠ½ç±¤å·¥å…·</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.4.120/pdf.min.js"></script>
  <style>
    body { font-family: sans-serif; padding: 20px; max-width: 600px; margin: auto; }
    .category { margin-top: 20px; padding: 10px; border: 1px solid #ccc; border-radius: 8px; }
    .item { margin-left: 10px; }
    button { margin-top: 10px; }
    input { margin: 0 5px; width: 80px; }
  </style>
</head>
<body>
  <h2>ğŸ“„ ä¸Šå‚³ PDF ä¸¦æŠ½å…©é“é¤é»</h2>
  <input type="file" id="fileInput" /><br/>

  <div style="margin-top: 10px;">
    <label>é ç®— â‰¤</label><input id="maxPrice" type="number" value="200" />
    <label>ç†±é‡ â‰¤</label><input id="maxKcal" type="number" value="1500" />
  </div>

  <div id="output"></div>

  <script>
    let data = [];

    document.getElementById('fileInput').addEventListener('change', async (e) => {
      const file = e.target.files[0];
      if (!file) return;
      const pdf = await pdfjsLib.getDocument({ data: await file.arrayBuffer() }).promise;

      data = [];
      let fullText = '';
      for (let i = 1; i <= pdf.numPages; i++) {
        const content = await (await pdf.getPage(i)).getTextContent();
        fullText += content.items.map(item => item.str).join(' ') + '\n';
      }

      fullText.split('\n').forEach(line => {
        const parts = line.trim().split(/\s+/);
        if (parts.length >= 4) {
          const [category, name, kcal, price] = parts;
          if (!isNaN(kcal) && !isNaN(price)) {
            data.push({category, name, kcal, price});
          }
        }
      });

      const grouped = {};
      data.forEach(i => {
        if (!grouped[i.category]) grouped[i.category] = [];
        grouped[i.category].push(i);
      });

      const out = document.getElementById('output');
      out.innerHTML = '';
      for (const [cat, items] of Object.entries(grouped)) {
        const div = document.createElement('div');
        div.className = 'category';
        div.innerHTML = `<h3>ğŸ“ ${cat}</h3>`;
        items.forEach(i => {
          div.innerHTML += `<div class="item">ğŸ± ${i.name} ï½œ ${i.kcal} kcal ï½œ $${i.price}</div>`;
        });
        out.appendChild(div);
      }

      const comboBtn = document.createElement('button');
      comboBtn.textContent = 'ğŸ² éš¨æ©ŸæŠ½å…©é“';
      comboBtn.onclick = () => {
        const maxPrice = parseInt(document.getElementById('maxPrice').value);
        const maxKcal = parseInt(document.getElementById('maxKcal').value);
        if (data.length < 2) return alert('éœ€è‡³å°‘å…©å€‹è³‡æ–™æ‰å¯æŠ½ã€‚');
        let tries = 100, a, b, tp, tk;
        while (tries--) {
          a = data[Math.floor(Math.random() * data.length)];
          b = data[Math.floor(Math.random() * data.length)];
          if (a.name === b.name && a.category === b.category) continue;
          tp = parseInt(a.price) + parseInt(b.price);
          tk = parseInt(a.kcal) + parseInt(b.kcal);
          if (tp <= maxPrice && tk <= maxKcal) break;
        }
        if (tp > maxPrice || tk > maxKcal) {
          return alert('æœªæ‰¾åˆ°ç¬¦åˆæ¢ä»¶çš„çµ„åˆï¼Œè«‹æ”¾å¯¬ä¸Šé™');
        }
        alert(`ğŸ¯ ä»Šæ—¥æ¨è–¦ï¼š\n1ï¸âƒ£ ${a.name}ï¼ˆ${a.kcal} kcal / $${a.price}ï¼‰\n2ï¸âƒ£ ${b.name}ï¼ˆ${b.kcal} kcal / $${b.price}ï¼‰\nâ¡ï¸ ç¸½è¨ˆï¼š${tk} kcalï¼Œ$${tp}`);
      };
      out.appendChild(comboBtn);
    });
  </script>
</body>
</html>
